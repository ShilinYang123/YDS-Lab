# YDS-Lab长记忆系统使用方法和端口配置说明

## 📋 系统概述

YDS-Lab长记忆系统是一个**无端口依赖**的内存数据库系统，通过模块化API提供服务，不需要独立的网络端口。

## 🚀 快速启动

### 1. 基本使用方法

```bash
# 进入系统目录
cd S:\YDS-Lab\memory-system

# 安装依赖（首次使用）
npm install

# 编译TypeScript代码
npm run build

# 启动系统（开发模式）
npm run dev

# 生产环境启动
npm start
```

### 2. 系统初始化

```bash
# 初始化记忆系统
node scripts/init-memory.js

# 验证配置
npm run validate-config
```

## 🔧 配置说明

### 主配置文件：memory-config.yaml

```yaml
# 系统基础配置
system:
  name: "YDS-Lab Memory System"
  version: "1.0.0"
  environment: "production"  # development | production
  debug: false

# 数据存储路径
storage:
  memory_path: "./data/memories"
  knowledge_graph_path: "./data/knowledge-graph"
  rules_path: "./.trae/rules"
  cache_path: "./data/cache"
```

### 重要配置项

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `system.environment` | production | 运行环境 |
| `system.debug` | false | 调试模式 |
| `storage.memory_path` | ./data/memories | 记忆存储路径 |
| `rules.cache.ttl` | 3600 | 规则缓存时间(秒) |
| `backup.auto_backup.interval` | 86400 | 自动备份间隔(秒) |

## 🌐 网络和端口说明

### ⚠️ 重要：本系统无需端口配置

**YDS-Lab长记忆系统采用内存数据库架构，不依赖网络端口：**

- ✅ **无HTTP服务器**：系统通过模块导入方式提供API
- ✅ **无TCP/UDP端口**：所有数据存储在本地文件系统
- ✅ **无网络依赖**：完全离线运行
- ✅ **进程内通信**：通过EventEmitter进行组件间通信

### 集成方式

```javascript
// 方式1：直接导入
const { LongTermMemorySystem } = require('./dist');

// 方式2：通过符号链接
const memorySystem = require('../memory-system');

// 方式3：作为npm包
const memorySystem = require('@yds-lab/memory-system');
```

## 📚 API使用方法

### 1. 系统初始化

```javascript
const { LongTermMemorySystem } = require('./dist');

// 创建实例
const memorySystem = new LongTermMemorySystem();

// 初始化系统
await memorySystem.initialize();
```

### 2. 记忆操作

```javascript
// 存储记忆
const memory = await memorySystem.storeMemory({
  content: '项目重要决策：采用微服务架构',
  type: 'decision',
  importance: 8,
  metadata: {
    project: 'YDS-Lab',
    category: 'architecture',
    tags: ['microservices', 'decision']
  }
});

// 检索记忆
const results = await memorySystem.retrieveMemories('微服务架构', {
  limit: 10,
  minConfidence: 0.7,
  sortBy: 'relevance'
});

// 更新记忆
await memorySystem.updateMemory(memory.id, {
  importance: 9,
  metadata: { ...memory.metadata, status: 'implemented' }
});
```

### 3. 知识图谱操作

```javascript
// 获取知识图谱管理器
const kgManager = memorySystem.knowledgeGraphManager;

// 添加知识节点
const node = await kgManager.addNode({
  type: 'project',
  content: 'YDS-Lab AI公司',
  metadata: { status: 'active' }
});

// 建立关系
await kgManager.addEdge({
  sourceId: node.id,
  targetId: anotherNode.id,
  type: 'contains',
  weight: 0.8
});
```

## 🛠️ 开发和维护命令

### NPM脚本命令

```bash
# 开发相关
npm run dev          # 开发模式运行
npm run build        # 编译TypeScript
npm run clean        # 清理编译文件

# 测试相关
npm test             # 运行测试
npm run test:watch   # 监视模式测试
npm run test:coverage # 测试覆盖率

# 代码质量
npm run lint         # 代码检查
npm run lint:fix     # 自动修复代码问题
npm run format       # 代码格式化

# 系统维护
npm run validate-config  # 验证配置
npm run init-memory     # 重新初始化系统
```

### 自定义脚本

```bash
# 配置验证
node config-validation.js

# 性能分析
node performance-analysis.js

# 安全审计
node security-audit.js

# 系统测试
node test-memory-system.js
```

## 📁 目录结构说明

```
memory-system/
├── src/                    # TypeScript源代码
│   ├── config/            # 配置管理模块
│   ├── services/          # 核心服务
│   │   ├── knowledge-graph/    # 知识图谱服务
│   │   ├── memory-retrieval/   # 记忆检索服务
│   │   └── rule-system/        # 规则系统服务
│   ├── types/             # 类型定义
│   └── utils/             # 工具函数
├── dist/                  # 编译输出目录
├── data/                  # 数据存储目录
│   ├── memories/          # 记忆数据
│   ├── knowledge-graph/   # 知识图谱数据
│   └── cache/             # 缓存数据
├── logs/                  # 日志文件
├── S:\\YDS-Lab\\backups\\       # 顶层备份目录（统一存放所有备份）
├── scripts/               # 部署和维护脚本
├── .trae/                 # Trae配置
│   └── rules/             # 规则文件
├── memory-config.yaml     # 主配置文件
├── package.json           # 项目配置
└── tsconfig.json          # TypeScript配置
```

## 🔄 与YDS-Lab项目集成

### 1. 项目集成配置

```yaml
# memory-config.yaml
integration:
  yds_lab:
    enabled: true
    projects_path: "../projects"      # YDS-Lab项目路径
    agents_path: "../Struc/TraeAgents" # 智能体路径
```

### 2. 在其他项目中使用

```javascript
// 在YDS-Lab其他项目中
const path = require('path');
const memorySystemPath = path.join(__dirname, '../memory-system');
const { LongTermMemorySystem } = require(memorySystemPath);

// 或者通过符号链接
const memorySystem = require('../memory');
```

## 🔍 监控和日志

### 日志配置

```yaml
# memory-config.yaml
logging:
  level: "info"              # debug | info | warn | error
  outputs:
    - type: "console"
    - type: "file"
      path: "./logs/system.log"
  format: "json"
```

### 性能监控

```javascript
// 获取系统状态
const status = await memorySystem.getSystemStatus();
console.log('系统状态:', status);

// 性能指标
const metrics = memorySystem.performanceMonitor.getMetrics();
console.log('性能指标:', metrics);
```

## 🚨 故障排除

### 常见问题

1. **TypeScript编译错误**
   ```bash
   npm run clean
   npm run build
   ```

2. **数据目录权限问题**
   ```bash
   # 确保数据目录存在且可写
   mkdir -p data/memories data/knowledge-graph data/cache
   ```

3. **配置文件错误**
   ```bash
   npm run validate-config
   ```

4. **内存使用过高**
   ```bash
   # 清理缓存
   node -e "require('./dist').longTermMemorySystem.clearCache()"
   ```

### 系统重置

```bash
# 完全重置系统
npm run clean
rm -rf data/* logs/*
# 注意：不再在项目内清理 backups/，所有备份统一位于顶层 S:\\YDS-Lab\\backups\\
npm run build
node scripts/init-memory.js
```

## 📊 系统状态检查

```bash
# 快速状态检查
node -e "
const { LongTermMemorySystem } = require('./dist');
const system = new LongTermMemorySystem();
system.initialize().then(() => {
  console.log('✅ 系统运行正常');
  console.log('📊 状态:', system.getSystemStatus());
}).catch(err => {
  console.error('❌ 系统错误:', err.message);
});
"
```

## 🔐 安全注意事项

1. **数据加密**：生产环境建议启用数据加密
2. **访问控制**：配置适当的文件权限
3. **备份策略**：定期备份重要数据
4. **日志管理**：避免在日志中记录敏感信息

---

**最后更新时间**: 2025-11-01  
**系统版本**: v1.0.0  
**文档状态**: ✅ 完整记录