# TraeMate 开发任务书

## 项目背景和目标
TraeMate 是一款用于自动监控 Trae 运行状态、保障 Agent 连续工作的 Windows 工具。通过自动检测 Trae 界面状态并自动点击"继续"按钮，保障用户无需手动干预即可高效连续工作。

### 项目目标
1. 提高用户使用 Trae 的连续性和效率，减少手动干预≥95%
2. 实现 7×24 小时不间断监控，确保工作流程不中断，系统可用性≥99.5%
3. 提供直观的状态反馈和灵活的配置选项，用户满意度≥90%
4. 打造美观、易用的用户界面，提升用户体验，新用户上手时间≤5分钟

### 项目范围
1. 核心功能（MVP）：自动监控 Trae 界面状态并自动点击"继续"按钮
2. 扩展功能（二期）：自定义处理项、多进程监控、屏幕适配
3. 用户界面：顶部悬浮状态栏、系统托盘集成
4. 辅助功能：日志系统、配置管理、错误处理

### 项目成功标准
1. 功能完整性：100%实现需求规格说明中的所有核心功能
2. 性能指标：满足"预期成果与交付标准"中定义的所有性能指标
3. 用户验收：通过用户验收测试，用户满意度≥90%
4. 文档完整性：交付所有必需文档，文档质量评分≥85分
5. 稳定性测试：连续运行72小时无崩溃，异常恢复率≥99%

## 功能需求

### 核心功能（高优先级）
1. **[高] 定时检测 Trae 界面**，自动识别"模型思考已达上限"提示。
2. **[高] 自动点击"继续"按钮**，并具备冷却机制防止误触发。
3. **[高] 顶部悬浮状态栏**，显示当前监控状态。
4. **[高] 圆点闪烁指示灯**，仅显示一个纯色圆点，无任何外圈或发光。
5. **[高] 状态栏宽度适中（420像素）**，两端留有空间，整体美观协调。
6. **[高] 状态栏可通过鼠标拖动移动**，提升用户体验。
7. **[高] 界面风格高档美观**，倒圆角、半透明藏青色背景、控件背景色统一。
8. **[高] 最小化/托盘/关闭功能**，按钮 hover 高亮，布局紧凑。
9. **[高] 无需中途手动处理，所有功能全自动化。**

### 扩展功能（中优先级）
10. **[中] 自定义处理项功能**，支持用户添加自定义按钮图片和提示信息。
11. **[中] 进程检测功能**，可配置监控特定进程（如trae、cursor）。
12. **[中] 屏幕缩放适配**，支持不同DPI设置下的模板缩放。
13. **[中] 多阈值配置**，主按钮和自定义处理项可设置不同匹配阈值。

### 文档功能（低优先级）
14. **[低] 日志系统、配置文件、依赖清单、使用说明、FAQ 等文档齐全**。

### 用户场景分析
1. **重度用户场景**：长时间使用 Trae 进行开发工作，需要不间断监控，减少手动干预
2. **轻度用户场景**：偶尔使用 Trae，需要简单易用的界面和基本监控功能
3. **技术用户场景**：需要自定义处理项和高级配置，满足特定工作流程需求
4. **企业用户场景**：需要稳定可靠的监控，支持多进程监控和详细日志记录

### 非功能性需求
1. **性能需求**：
   - 监控响应时间：≤5秒
   - CPU占用率：≤5%（空闲时）
   - 内存占用：≤50MB
   - 启动时间：≤3秒

2. **可靠性需求**：
   - 连续运行72小时无崩溃
   - 异常恢复率≥99%
   - 数据丢失率≤0.1%

3. **可用性需求**：
   - 新用户上手时间≤5分钟
   - 用户满意度≥90%
   - 操作步骤≤3步完成常用功能

4. **兼容性需求**：
   - 支持Windows 7/8/10/11
   - 支持100%-200% DPI缩放
   - 支持1080p、2K、4K分辨率

5. **安全性需求**：
   - 不收集用户隐私数据
   - 配置文件加密存储
   - 进程访问权限最小化

6. **可维护性需求**：
   - 模块化设计，便于扩展
   - 代码注释覆盖率≥80%
   - 日志记录完整，便于问题定位

## 状态栏详细设计
### 状态栏布局与尺寸
- **窗口尺寸**：420×32像素
- **背景色**：#2c3553（深藏青色）
- **透明度**：0.7（70%）
- **圆角半径**：12像素
- **初始位置**：屏幕顶部中央，距离顶部0像素

### 状态栏组件
1. **左侧状态文本**
   - 字体：微软雅黑，9号
   - 颜色：#F8F8F8（浅白色）
   - 默认文本："Trae状态监控中..."
   - 其他状态文本：
     - "暂停监控"
     - "已自动点击'继续'按钮"
     - "已自动点击自定义项: [处理项名称]"
     - "检测模块未安装，监控已停用"

2. **中间指示灯**
   - 位置：状态文本右侧
   - 尺寸：14×14像素画布，内部圆形直径10像素
   - 颜色状态：
     - 监控中闪烁：#00ff00（绿色）与#004400（深绿色）交替
     - 暂停监控：#888888（灰色，来自配置）
     - 检测模块未安装：#888888（灰色）
   - 闪烁间隔：1.0秒（可配置）
   - 点击功能：切换监控状态

3. **右侧应用信息与控制按钮**
   - 应用信息：
     - 字体：微软雅黑，9号
     - 颜色：#F8F8F8（浅白色）
     - 格式："{app_name}  {author}"（如："TraeMate  杨世林 3AI"）
   - 最小化按钮：
     - 文本："_"
     - hover效果：背景色变为#3e4970
   - 关闭按钮：
     - 文本："×"
     - hover效果：背景色变为#c0392b（红色）

### 状态栏交互功能
1. **拖动移动**：点击状态栏任意位置可拖动窗口
2. **右键菜单**：
   - 新增处理项
   - 查看日志
   - 缩小到托盘区
   - 退出
3. **指示灯点击**：切换监控状态（监控中/暂停）
4. **最小化功能**：隐藏窗口到系统托盘（需pystray支持）

## 自定义处理项功能
### 处理项配置
- 支持添加多个自定义处理项
- 每个处理项包含：
  - 名称（可选）
  - 系统提示信息（必填）
  - 按钮图片（必填）
- 图片支持上传本地文件或屏幕截图
- 图片自动保存为handler_btn_{时间戳}.png格式

### 检测机制
- 使用OpenCV模板匹配技术
- 支持屏幕缩放适配（scale_factor配置）
- 主按钮阈值：0.60（可配置）
- 自定义处理项阈值：0.85（可配置）
- 冷却时间：30秒（可配置）

## 进程监控功能
- 使用psutil库检测目标进程
- 默认监控进程：trae、cursor
- 可配置跳过进程检查（skip_process_check）
- 异常时默认允许继续监控，避免功能中断

## 技术方案

### 技术架构
```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面层 (UI Layer)                      │
├─────────────────────────────────────────────────────────────┤
│  状态栏组件  │  托盘菜单  │  配置界面  │  日志查看器  │  对话框  │
├─────────────────────────────────────────────────────────────┤
│                   业务逻辑层 (Business Layer)                 │
├─────────────────────────────────────────────────────────────┤
│  监控管理器  │  处理项管理  │  配置管理器  │  日志管理器  │  事件管理器  │
├─────────────────────────────────────────────────────────────┤
│                   服务层 (Service Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  图像识别服务  │  自动点击服务  │  进程监控服务  │  文件服务  │  系统服务  │
├─────────────────────────────────────────────────────────────┤
│                   数据访问层 (Data Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  配置文件  │  日志文件  │  图片文件  │  临时文件  │  系统注册表  │
└─────────────────────────────────────────────────────────────┘
```

### 技术选型
- **编程语言**：Python 3.8+
- **图形界面**：Tkinter
- **图像处理**：OpenCV
- **自动化操作**：pyautogui
- **图片处理**：PIL (Pillow)
- **进程监控**：psutil
- **系统托盘**：pystray
- **日志系统**：datetime, logging
- **配置管理**：json
- **数学计算**：numpy
- **系统调用**：ctypes

### 关键技术难点
1. **图像识别准确性**：
   - 难点：不同分辨率和DPI下的模板匹配
   - 解决方案：实现多尺度模板匹配和自适应阈值

2. **跨平台兼容性**：
   - 难点：不同Windows版本的API差异
   - 解决方案：使用兼容性API，版本检测和适配

3. **性能优化**：
   - 难点：长时间运行的资源占用控制
   - 解决方案：智能休眠机制，资源使用监控

4. **系统托盘集成**：
   - 难点：不同系统下的托盘图标和菜单行为
   - 解决方案：使用pystray库，提供备选方案

### 技术风险评估
1. **OpenCV依赖风险**：
   - 风险等级：中
   - 影响：图像识别功能无法使用
   - 备选方案：PIL.ImageOps或自定义图像处理算法

2. **pyautogui兼容性风险**：
   - 风险等级：中
   - 影响：自动点击功能不稳定
   - 备选方案：使用Windows API或ctypes直接调用

3. **Tkinter界面限制**：
   - 风险等级：低
   - 影响：界面美观度和交互体验受限
   - 备选方案：PyQt或PySide（需要额外依赖）

## 项目计划

### 项目里程碑
| 里程碑 | 计划完成时间 | 关键交付物 | 验收标准 |
|--------|-------------|-----------|----------|
| M1: 需求确认 | 第1天 | 需求规格说明书 | 所有干系人签字确认 |
| M2: 设计完成 | 第3天 | 详细设计文档、原型 | 设计评审通过 |
| M3: 核心功能开发 | 第6天 | 可运行的核心功能 | 核心功能演示通过 |
| M4: 完整功能开发 | 第8天 | 完整应用程序 | 功能测试通过率≥95% |
| M5: 测试与优化 | 第10天 | 测试报告、优化版本 | 性能指标达标 |
| M6: 发布准备 | 第11天 | 安装包、用户手册 | 发布评审通过 |

### 详细工作分解
#### 第一阶段：需求分析与设计 (第1-3天)
- **第1天**：
  - 详细需求调研与分析
  - 用户场景建模
  - 功能需求细化
  - 非功能性需求定义
  - 交付物：需求规格说明书

- **第2天**：
  - 系统架构设计
  - 技术选型确认
  - 接口设计
  - 数据模型设计
  - 交付物：架构设计文档

- **第3天**：
  - UI/UX设计
  - 原型制作
  - 设计评审
  - 需求确认
  - 交付物：设计文档、交互原型

#### 第二阶段：核心功能开发 (第4-6天)
- **第4天**：
  - 开发环境搭建
  - 基础框架搭建
  - 配置管理模块
  - 日志系统
  - 交付物：基础框架代码

- **第5天**：
  - 图像识别模块
  - 自动点击模块
  - 状态栏组件
  - 交付物：核心功能模块

- **第6天**：
  - 监控管理器
  - 处理项管理
  - 基础测试
  - 交付物：可运行的核心功能版本

#### 第三阶段：扩展功能开发 (第7-8天)
- **第7天**：
  - 系统托盘集成
  - 进程监控功能
  - 自定义处理项
  - 交付物：扩展功能模块

- **第8天**：
  - 配置界面
  - 日志查看器
  - 异常处理
  - 交付物：完整功能版本

#### 第四阶段：测试与优化 (第9-10天)
- **第9天**：
  - 功能测试
  - 性能测试
  - 兼容性测试
  - 交付物：测试报告

- **第10天**：
  - 性能优化
  - Bug修复
  - 稳定性测试
  - 交付物：优化版本

#### 第五阶段：发布准备 (第11天)
- **第11天**：
  - 安装包制作
  - 用户文档编写
  - 发布评审
  - 交付物：发布版本

### 资源分配
| 角色 | 人数 | 参与阶段 | 主要职责 |
|------|------|---------|----------|
| 项目经理 | 1 | 全程 | 项目管理、进度控制、风险管控 |
| UI设计师 | 1 | 第1-3天 | 界面设计、交互设计 |
| 前端开发 | 1 | 第4-8天 | 界面开发、用户体验实现 |
| 后端开发 | 1 | 第4-8天 | 核心逻辑、图像处理、自动化 |
| 测试工程师 | 1 | 第9-10天 | 测试用例设计、测试执行 |
| 技术文档 | 0.5 | 第10-11天 | 用户手册、技术文档 |

### 关键路径分析
1. 核心功能开发路径：需求分析 → 架构设计 → 图像识别模块 → 自动点击模块 → 监控管理器
2. 关键路径总时长：8天
3. 缓冲时间：3天（用于测试、优化和发布准备）

### 进度控制机制
1. **每日站会**：同步进度、识别障碍
2. **周报机制**：每周五提交进度报告
3. **里程碑评审**：每个里程碑完成后进行评审
4. **风险预警**：提前识别风险，制定应对措施
5. **变更管理**：需求变更需经过评估和审批

## 资源需求

### 人力资源需求
| 角色 | 技能要求 | 投入比例 | 关键职责 |
|------|---------|----------|----------|
| 项目经理 | 项目管理、风险控制 | 100% | 项目规划、进度控制、风险管理 |
| UI设计师 | 界面设计、交互设计 | 30% | 界面设计、用户体验优化 |
| 前端开发 | Python、Tkinter | 100% | 界面开发、用户交互实现 |
| 后端开发 | Python、OpenCV、系统API | 100% | 核心算法、图像处理、自动化 |
| 测试工程师 | 测试设计、自动化测试 | 60% | 测试用例设计、质量保证 |
| 技术文档 | 技术写作、文档规范 | 20% | 用户手册、技术文档编写 |

### 硬件资源需求
| 设备类型 | 配置要求 | 数量 | 用途 |
|----------|---------|------|------|
| 开发机 | Windows 10/11, 8GB RAM, SSD | 2 | 主要开发环境 |
| 测试机 | Windows 10/11, 4GB RAM | 2 | 兼容性测试 |
| 高分辨率显示器 | 2K/4K分辨率 | 1 | 高DPI测试 |
| 普通显示器 | 1080p分辨率 | 2 | 常规分辨率测试 |
| 触摸屏设备 | Windows触摸屏 | 1 | 触摸交互测试 |

### 软件资源需求
| 软件类型 | 具体软件 | 版本要求 | 用途 |
|----------|---------|----------|------|
| 开发环境 | Python | 3.8+ | 主要开发语言 |
| | OpenCV | 4.5+ | 图像处理 |
| | Tkinter | 内置 | GUI开发 |
| | pyautogui | 0.9.53+ | 自动化操作 |
| | PIL (Pillow) | 8.0+ | 图像处理 |
| | psutil | 5.8+ | 系统监控 |
| | pystray | 0.19+ | 系统托盘 |
| | numpy | 1.21+ | 数值计算 |
| | ctypes | 内置 | 系统调用 |
| 开发工具 | VS Code | 最新版 | 代码编辑 |
| | Git | 2.30+ | 版本控制 |
| 测试工具 | Pytest | 6.2+ | 单元测试 |
| | Selenium | 4.0+ | UI自动化测试 |
| | JMeter | 5.4+ | 性能测试 |
| 文档工具 | Markdown | - | 文档编写 |
| | Draw.io | - | 架构图绘制 |

### 环境配置需求
1. **开发环境**：
   - Python虚拟环境隔离
   - 代码格式化工具配置
   - 静态代码分析工具
   - 持续集成环境

2. **测试环境**：
   - 多版本Windows系统（10/11）
   - 不同DPI设置（100%, 125%, 150%, 200%）
   - 不同分辨率（1920×1080, 2560×1440, 3840×2160）
   - 不同安全级别设置

3. **部署环境**：
   - 打包环境配置
   - 安装包测试环境
   - 用户环境模拟

### 预算估算
| 费用类别 | 估算金额 | 说明 |
|----------|---------|------|
| 人力成本 | 根据团队规模和周期计算 | 按人天计算 |
| 硬件成本 | ¥15,000 | 测试设备、显示器等 |
| 软件许可 | ¥5,000 | 开发工具、测试工具等 |
| 其他费用 | ¥3,000 | 文档、培训等 |
| **总计** | **¥23,000+人力成本** | 不包含人力成本 |

### 外部依赖
1. **第三方库**：
   - OpenCV：图像处理核心依赖
   - pyautogui：自动化操作核心依赖
   - psutil：系统监控依赖

2. **系统API**：
   - Windows API：窗口管理、系统信息获取
   - 注册表访问：配置存储

3. **潜在风险**：
   - 第三方库版本兼容性
   - Windows系统更新影响
   - 安全软件拦截风险

## 配置文件说明
- config.json：主配置文件，包含窗口、指示器、监控、检测等参数
- memory.json：内存数据存储（如有）
- 日志文件：trae_mate_log.txt，记录操作日志和错误信息

## 打包发布
- 使用PyInstaller打包为独立exe文件
- 打包脚本：build_exe.py
- 打包配置：trae_mate.spec
- 支持打包时包含配置文件和资源文件

## 预期成果

### 主要交付物
| 交付物类型 | 具体内容 | 交付标准 | 验收方式 |
|-----------|---------|----------|----------|
| 应用程序 | 可执行程序、安装包 | 可在Windows 10/11上稳定运行 | 功能演示、稳定性测试 |
| 用户文档 | 用户手册、安装指南、FAQ | 内容完整、图文并茂、易于理解 | 用户评审 |
| 技术文档 | 架构设计、API文档、代码注释 | 符合技术文档规范 | 技术评审 |
| 测试报告 | 功能测试报告、性能测试报告 | 测试覆盖率≥95%，性能指标达标 | 质量评审 |
| 源代码 | 完整源代码、版本控制记录 | 代码规范、注释完整 | 代码审查 |

### 成功指标
1. **功能完整性**：100%实现核心功能，95%实现扩展功能
2. **性能指标**：
   - 图像识别准确率≥95%
   - 响应时间≤500ms
   - 内存占用≤100MB
   - CPU占用≤5%（空闲状态）
3. **用户体验**：
   - 用户满意度≥90%
   - 新用户上手时间≤5分钟
   - 操作失误率≤5%
4. **稳定性**：
   - 72小时连续运行无崩溃
   - 异常恢复率≥99%
   - 资源泄漏为零

### 长期价值
1. **效率提升**：减少用户重复操作时间≥80%
2. **错误减少**：降低人为操作错误率≥90%
3. **可扩展性**：支持未来功能扩展和定制需求
4. **知识积累**：形成可复用的技术组件和解决方案

## 风险评估与应对

### 技术风险
| 风险项 | 风险等级 | 影响 | 应对措施 | 负责人 | 监控指标 |
|--------|---------|------|----------|--------|----------|
| 图像识别准确性 | 中 | 核心功能失效 | 多算法融合、自适应阈值 | 技术负责人 | 识别准确率≥95% |
| 第三方库兼容性 | 中 | 功能异常 | 版本锁定、备选方案 | 开发人员 | 依赖库稳定性 |
| 系统API变更 | 低 | 部分功能失效 | 版本检测、兼容层 | 开发人员 | API兼容性测试 |
| 性能瓶颈 | 中 | 用户体验差 | 性能监控、优化算法 | 开发人员 | 响应时间≤500ms |

### 项目风险
| 风险项 | 风险等级 | 影响 | 应对措施 | 负责人 | 监控指标 |
|--------|---------|------|----------|--------|----------|
| 需求变更 | 中 | 进度延迟 | 变更控制、影响评估 | 项目经理 | 变更次数≤3次 |
| 人员流失 | 低 | 进度影响 | 知识文档化、交叉培训 | 项目经理 | 人员稳定性 |
| 进度延期 | 中 | 交付延迟 | 缓冲时间、优先级调整 | 项目经理 | 里程碑达成率 |
| 质量问题 | 中 | 用户不满 | 测试加强、质量门禁 | 测试负责人 | 缺陷密度≤1/KLOC |

### 业务风险
| 风险项 | 风险等级 | 影响 | 应对措施 | 负责人 | 监控指标 |
|--------|---------|------|----------|--------|----------|
| 用户接受度低 | 中 | 推广困难 | 用户参与、易用性设计 | 产品经理 | 用户满意度≥90% |
| 安全软件拦截 | 中 | 功能受限 | 白名单申请、签名认证 | 技术负责人 | 兼容性测试通过率 |
| 系统更新影响 | 低 | 功能异常 | 持续监控、快速响应 | 运维人员 | 系统兼容性 |
| 竞品冲击 | 低 | 市场份额 | 差异化功能、持续创新 | 产品经理 | 功能优势保持 |

### 风险监控机制
1. **周度风险评估**：每周五进行风险评估和更新
2. **预警机制**：关键指标达到阈值时自动预警
3. **应急预案**：针对高风险项制定详细应急预案
4. **风险日志**：记录所有风险事件和处理过程

## 质量保证

### 质量标准
1. **代码质量**：
   - 遵循PEP 8编码规范
   - 代码注释覆盖率≥80%
   - 圈复杂度≤10
   - 代码重复率≤5%

2. **测试质量**：
   - 单元测试覆盖率≥80%
   - 集成测试覆盖率≥90%
   - 系统测试用例≥100个
   - 自动化测试率≥70%

3. **文档质量**：
   - 文档完整性评分≥85分
   - 用户文档可读性评分≥90分
   - 技术文档准确性评分≥95分

### 质量保证流程
```
需求评审 → 设计评审 → 代码审查 → 单元测试 → 集成测试 → 系统测试 → 用户验收测试 → 发布评审
```

### 质量控制活动
1. **代码审查**：
   - 每个代码提交必须经过审查
   - 关键模块需要双人审查
   - 使用自动化代码质量检查工具

2. **测试活动**：
   - 测试用例设计和评审
   - 测试执行和缺陷跟踪
   - 回归测试和性能测试

3. **质量度量**：
   - 每周质量指标报告
   - 缺陷趋势分析
   - 质量改进措施跟踪

### 质量工具
1. **静态代码分析**：pylint, flake8
2. **测试框架**：pytest, unittest
3. **持续集成**：GitHub Actions, Jenkins
4. **缺陷跟踪**：GitHub Issues, JIRA
5. **代码覆盖率**：coverage.py

### 质量改进机制
1. **质量回顾**：每个里程碑结束后进行质量回顾
2. **最佳实践分享**：定期分享开发最佳实践
3. **技术培训**：针对质量问题的技术培训
4. **质量激励**：设立质量奖项，激励高质量交付

---

**本任务书已根据最终用户反馈与实际交付效果，补充并明确了所有细节要求，确保项目成果高档美观、全自动、极致易用。**

## 附录

### 术语表
| 术语 | 定义 |
|------|------|
| DPI | 每英寸点数(Dots Per Inch)，衡量屏幕显示精度的指标 |
| 模板匹配 | 图像处理中用于在图像中查找特定模式的技术 |
| 系统托盘 | Windows任务栏右侧的通知区域，用于显示系统图标 |
| 进程监控 | 对计算机系统中运行的进程进行监视和管理的功能 |
| 异常恢复 | 系统在发生错误后自动恢复到正常状态的能力 |

### 参考资源
1. **Python官方文档**：https://docs.python.org/3/
2. **OpenCV文档**：https://docs.opencv.org/
3. **Tkinter文档**：https://docs.python.org/3/library/tkinter.html
4. **pyautogui文档**：https://pyautogui.readthedocs.io/
5. **Windows API文档**：https://docs.microsoft.com/en-us/windows/win32/api/

### 变更历史
| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 1.0 | 2025-06-17 | 初始版本创建 | 项目组 |
| 1.1 | 2025-06-17 | 添加量化指标和项目成功标准 | 项目组 |
| 1.2 | 2025-06-17 | 完善技术方案和项目计划 | 项目组 |
| 1.3 | 2025-06-17 | 扩展资源需求和风险评估 | 项目组 |
| 1.4 | 2025-06-17 | 完善质量保证措施 | 项目组 |

---

*本文档将根据项目进展和用户反馈持续更新，最后更新于：2025-06-17*
