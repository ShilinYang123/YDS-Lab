# TraeMate 2.0 - 系统监控与自动化工具

## 项目概述

TraeMate是一款系统监控与自动化工具，用于监控指定进程状态，并在检测到特定界面元素时自动执行点击操作。本工具采用模块化架构设计，具有良好的可扩展性和可维护性。

## 功能特性

- **进程监控**：监控指定进程的运行状态
- **图像识别**：基于OpenCV的模板匹配技术识别界面元素
- **自动点击**：自动执行鼠标点击操作
- **系统托盘**：最小化到系统托盘，支持后台运行
- **配置管理**：灵活的配置系统，支持自定义监控参数
- **日志记录**：详细的日志记录，便于问题排查
- **自定义处理项**：支持添加自定义图像识别和点击处理项

## 系统架构

TraeMate采用分层架构设计，主要分为以下几个层次：

### 1. 数据层 (src/data)
- **ConfigManager**：配置管理器，负责加载、保存和验证配置
- **LogManager**：日志管理器，负责日志的写入、读取和管理

### 2. 服务层 (src/services)
- **ImageRecognitionService**：图像识别服务，负责屏幕截图和模板匹配
- **AutoClickService**：自动点击服务，负责鼠标操作
- **ProcessMonitorService**：进程监控服务，负责进程状态检测

### 3. 业务逻辑层 (src/business)
- **MonitorManager**：监控管理器，协调各服务模块，实现监控逻辑
- **HandlerManager**：处理项管理器，管理自定义处理项

### 4. UI层 (src/ui)
- **StatusBar**：状态栏组件，显示监控状态和指示器
- **SystemTray**：系统托盘组件，管理托盘图标和菜单
- **Dialogs**：对话框组件，提供配置对话框和日志查看对话框

## 安装与使用

### 环境要求

- Python 3.7+
- Windows操作系统

### 安装步骤

1. 克隆项目代码
2. 安装依赖包：
   ```
   pip install -r requirements.txt
   ```
3. 运行程序：
   ```
   python main.py
   ```

### 配置说明

配置文件为`config.json`，主要配置项包括：

- **app_name**：应用程序名称
- **window**：窗口设置（宽度、高度、背景色、透明度）
- **indicator**：指示器设置（大小、闪烁间隔）
- **monitor**：监控设置（检查间隔、冷却时间、进程名称）
- **detection**：检测设置（缩放因子、匹配阈值）
- **custom_handlers**：自定义处理项列表

### 使用说明

1. **启动程序**：运行`main.py`启动程序
2. **配置监控**：通过系统托盘菜单打开配置对话框，设置监控参数
3. **开始监控**：点击系统托盘菜单中的"开始监控"选项
4. **查看日志**：通过系统托盘菜单查看运行日志

## 开发指南

### 项目结构

```
TraeMate/
├── src/                    # 源代码目录
│   ├── data/              # 数据层
│   ├── services/          # 服务层
│   ├── business/          # 业务逻辑层
│   └── ui/                # UI层
├── tests/                 # 测试代码目录
├── resources/             # 资源文件目录
├── docs/                  # 文档目录
├── config.json            # 配置文件
├── main.py                # 主程序入口
└── requirements.txt       # 依赖包列表
```

### 扩展开发

1. **添加新的服务**：在`src/services`目录下创建新的服务类
2. **添加新的业务逻辑**：在`src/business`目录下创建新的业务逻辑类
3. **添加新的UI组件**：在`src/ui`目录下创建新的UI组件类
4. **添加新的配置项**：在`config.json`中添加新的配置项，并在`ConfigManager`中添加相应的处理逻辑

### 测试

运行测试：
```
pytest tests/
```

生成测试覆盖率报告：
```
pytest --cov=src tests/
```

## 常见问题

### 1. 程序无法启动

- 检查Python版本是否符合要求
- 检查依赖包是否正确安装
- 检查配置文件是否存在且格式正确

### 2. 图像识别不准确

- 调整检测阈值（`threshold_main`和`threshold_handlers`）
- 调整缩放因子（`scale_factor`）
- 确保图像模板与实际界面元素匹配

### 3. 自动点击不生效

- 检查目标进程是否具有焦点
- 检查坐标计算是否正确
- 检查是否有其他程序拦截鼠标事件

## 版本历史

### 2.0.0 (当前版本)
- 重构为分层架构
- 添加模块化设计
- 改进配置管理系统
- 增强日志记录功能
- 优化性能和稳定性

### 1.0.0 (原始版本)
- 基本监控功能
- 简单的图像识别
- 系统托盘集成

## 许可证

本项目采用MIT许可证，详情请参阅LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进本项目。

## 联系方式

如有问题或建议，请通过以下方式联系：

- 邮箱：[your-email@example.com]
- 项目地址：[https://github.com/your-username/TraeMate]