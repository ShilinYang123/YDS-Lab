# TraeLM 监控栈一键部署说明

## 1. 前置条件
- 已安装 Docker Desktop（Windows/Mac）或 Docker + docker-compose（Linux）
- TraeLM 已在 `http://localhost:8765/health` 启动，且 `/metrics` 可访问

## 2. 启动 Prometheus + Grafana
在 **本目录** 执行：
```bash
docker-compose up -d
```
如无 compose 文件，可手动两条命令：
```bash
# Prometheus
docker run -d --name prometheus -p 9090:9090 \
  -v ${PWD}/prometheus.yml:/etc/prometheus/prometheus.yml \
  prom/prometheus

# Grafana
docker run -d --name grafana -p 3000:3000 \
  -e GF_SECURITY_ADMIN_PASSWORD=admin \
  grafana/grafana
```

## 3. 导入看板
1. 浏览器打开 http://localhost:3000（默认账号 admin/admin）
2. 左侧 ⚙️ → "Data Sources" → Add "Prometheus" → URL 填 `http://prometheus:9090`（或 `http://localhost:9090`）→ Save & Test
3. 左侧 ➕ → "Import" → Upload `grafana-dashboard.json` → 选择刚才的 Prometheus → Import

## 4. 验证
- Prometheus  Targets：http://localhost:9090/targets  状态应为 UP
- Grafana 看板：http://localhost:3000/d/traelm  能看到 CPU、内存、端口、Ping、Python 退出码实时曲线

## 5. 日常维护
- 健康检查脚本 `health_check.ps1` 每 5 分钟自动推送指标，无需额外操作
- 日志轮转：同目录下 `log_rotate.ps1` 已配置，可加入计划任务
- 升级：替换 `grafana-dashboard.json` 后重新 Import 即可

## 6. 端口清单
| 服务      | 端口 | 说明                  |
|-----------|------|-----------------------|
| TraeLM    | 8765 | 业务 + 指标接口       |
| Prometheus| 9090 | 时序库 + 查询界面     |
| Grafana   | 3000 | 可视化看板            |

完成！现在你可以实时观察 TraeLM 的各项指标，出现告警时 Grafana 会邮件/钉钉通知（需在 Grafana Alerting 里配置渠道）。