# 开发环境配置指南

## 概述
本文档详细说明数字员工系统开发环境的配置要求、安装步骤和最佳实践。

## 系统要求

### 硬件要求
- **CPU**: 4核心以上，推荐8核心
- **内存**: 16GB以上，推荐32GB
- **存储**: 100GB可用空间，SSD推荐
- **网络**: 稳定网络连接

### 软件要求
- **操作系统**: Windows 10/11, macOS 10.15+, Ubuntu 20.04+
- **Node.js**: 18.0.0或更高版本
- **Docker**: 20.10+ 和 Docker Compose
- **Git**: 2.30+
- **VS Code**: 推荐IDE

## 环境安装

### 1. Node.js安装
```bash
# 使用Node版本管理器（推荐）
# macOS/Linux
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18

# Windows
# 下载nvm-windows并安装
# https://github.com/coreybutler/nvm-windows
```

### 2. Docker安装
```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER

# macOS
# 下载Docker Desktop for Mac
# https://www.docker.com/products/docker-desktop

# Windows
# 下载Docker Desktop for Windows
# https://www.docker.com/products/docker-desktop
```

### 3. Git配置
```bash
# 配置用户信息
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 配置SSH密钥
ssh-keygen -t rsa -b 4096 -C "your.email@example.com"
```

## 项目初始化

### 1. 克隆项目
```bash
git clone <repository-url>
cd digital-employee
```

### 2. 环境变量配置
```bash
# 复制环境变量模板
cp .env.example .env

# 编辑环境变量文件
# Windows
notepad .env
# macOS/Linux
nano .env
```

### 3. 基础环境变量
```env
# 基础配置
NODE_ENV=development
PORT=3001
API_PREFIX=/api/v1

# 数据库配置
DATABASE_URL=postgresql://postgres:postgres123@localhost:5432/digital_employee
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-key

# Redis配置
REDIS_URL=redis://localhost:6379

# MinIO配置
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_BUCKET=digital-employee

# JWT配置
JWT_SECRET=your-jwt-secret-key
JWT_EXPIRES_IN=7d

# AI服务配置
OPENAI_API_KEY=your-openai-api-key
AZURE_SPEECH_KEY=your-azure-speech-key
AZURE_SPEECH_REGION=your-region

# 文件上传配置
MAX_FILE_SIZE=10485760
UPLOAD_PATH=./uploads

# 日志配置
LOG_LEVEL=debug
LOG_FILE=./logs/development.log

# 前端配置
VITE_API_URL=http://localhost:3001
VITE_WS_URL=ws://localhost:3001
VITE_ENV=development
```

### 4. 启动基础服务
```bash
# 启动PostgreSQL、Redis、MinIO
docker-compose up -d postgres redis minio

# 验证服务状态
docker-compose ps
```

## 前端开发环境

### 1. 安装依赖
```bash
cd src
npm install
```

### 2. 开发服务器
```bash
# 启动开发服务器
npm run dev

# 访问应用
open http://localhost:3000
```

### 3. 开发工具配置

#### VS Code插件
```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "dsznajder.es7-react-js-snippets",
    "burkeholland.simple-react-snippets",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-typescript-next"
  ]
}
```

#### VS Code设置
```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "emmet.includeLanguages": {
    "javascript": "javascriptreact"
  }
}
```

## 后端开发环境

### 1. 安装依赖
```bash
cd api
npm install
```

### 2. 开发服务器
```bash
# 启动开发服务器
npm run dev

# API文档访问
open http://localhost:3001/docs
```

### 3. 数据库初始化
```bash
# 运行数据库迁移
npm run migrate

# 插入测试数据
npm run seed
```

### 4. 调试配置

#### VS Code调试配置
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug API",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/api/dist/server.js",
      "outFiles": ["${workspaceFolder}/api/dist/**/*.js"],
      "env": {
        "NODE_ENV": "development"
      },
      "console": "integratedTerminal"
    }
  ]
}
```

## 开发工具

### 1. 数据库工具
- **PgAdmin**: PostgreSQL管理
- **DBeaver**: 通用数据库管理
- **TablePlus**: 现代化数据库工具

### 2. API测试工具
- **Postman**: API测试
- **Insomnia**: REST客户端
- **Thunder Client**: VS Code插件

### 3. 容器管理工具
- **Docker Desktop**: 容器管理
- **Portainer**: Web界面管理
- **Lazydocker**: 终端容器管理

## 开发工作流

### 1. 功能开发流程
```bash
# 1. 创建功能分支
git checkout -b feature/your-feature-name

# 2. 开发功能
# ... 编写代码 ...

# 3. 运行测试
npm run test

# 4. 提交代码
git add .
git commit -m "feat: add your feature description"

# 5. 推送分支
git push origin feature/your-feature-name
```

### 2. 代码质量检查
```bash
# 运行ESLint检查
npm run lint

# 运行Prettier格式化
npm run format

# 运行类型检查
npm run type-check

# 运行测试
npm run test
```

### 3. Git Hooks配置
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write",
      "git add"
    ]
  }
}
```

## 常见问题解决

### 1. 端口冲突
```bash
# 查看端口占用
netstat -ano | findstr :3000  # Windows
lsof -i :3000                  # macOS/Linux

# 停止占用进程
taskkill /PID <PID> /F        # Windows
kill -9 <PID>                 # macOS/Linux
```

### 2. Docker容器问题
```bash
# 查看容器日志
docker-compose logs <service-name>

# 重启服务
docker-compose restart <service-name>

# 重新构建容器
docker-compose build --no-cache <service-name>
```

### 3. 依赖安装问题
```bash
# 清除npm缓存
npm cache clean --force

# 删除node_modules
rm -rf node_modules package-lock.json

# 重新安装依赖
npm install
```

### 4. 数据库连接问题
```bash
# 检查数据库服务
docker-compose ps postgres

# 测试数据库连接
docker-compose exec postgres pg_isready -U postgres

# 查看数据库日志
docker-compose logs postgres
```

## 性能优化

### 1. 开发环境优化
- 使用SSD硬盘
- 增加内存到32GB
- 使用多核心CPU
- 配置Docker资源限制

### 2. VS Code优化
```json
{
  "files.exclude": {
    "**/node_modules": true,
    "**/dist": true,
    "**/.git": true
  },
  "search.exclude": {
    "**/node_modules": true,
    "**/dist": true
  },
  "files.watcherExclude": {
    "**/node_modules/**": true
  }
}
```

### 3. Docker优化
```yaml
# docker-compose.override.yml
version: '3.8'
services:
  frontend:
    volumes:
      - /app/node_modules  # 避免node_modules挂载
  api:
    volumes:
      - /app/node_modules  # 避免node_modules挂载
```

## 环境验证

### 1. 服务状态检查
```bash
# 检查所有服务
docker-compose ps

# 检查端口监听
netstat -tlnp | grep -E "(3000|3001|5432|6379|9000)"

# 检查API健康状态
curl http://localhost:3001/health
```

### 2. 功能测试
```bash
# 测试数据库连接
node -e "console.log('Database connection test')"

# 测试Redis连接
node -e "console.log('Redis connection test')"

# 测试MinIO连接
node -e "console.log('MinIO connection test')"
```

## 开发环境维护

### 1. 定期更新
```bash
# 更新Docker镜像
docker-compose pull

# 更新npm包
npm update

# 更新开发工具
npm install -g npm@latest
```

### 2. 清理工作
```bash
# 清理Docker容器
docker system prune -f

# 清理npm缓存
npm cache clean --force

# 清理日志文件
find . -name "*.log" -delete
```