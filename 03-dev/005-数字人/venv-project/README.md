# 数字员工项目 - 虚拟环境实施方案

## 🎯 项目概述

基于虚拟环境的数字员工系统，采用前后端分离架构，支持AI驱动的数字人视频生成。

## 🏗️ 技术架构

### 核心技术栈
- **前端**: React 18 + TypeScript + Vite + Tailwind CSS
- **后端**: FastAPI + Python + SQLAlchemy + Pydantic
- **数据库**: PostgreSQL 16
- **缓存**: Redis 7.2
- **存储**: MinIO对象存储
- **AI模型**: LatentSync + CosyVoice

### 系统架构
```
┌─────────────────────────────────────────────────────────────┐
│                    前端界面 (React)                          │
│  ┌─────────────┬──────────────┬──────────────┬────────────┐ │
│  │ 仪表盘      │ 任务管理     │ 素材上传     │ 系统设置   │ │
│  └─────────────┴──────────────┴──────────────┴────────────┘ │
└─────────────────────────┬───────────────────────────────────┘
                          │
┌─────────────────────────┴───────────────────────────────────┐
│                  API网关 (FastAPI)                          │
│  ┌─────────────┬──────────────┬──────────────┬────────────┐ │
│  │ 任务管理    │ 文件上传     │ 状态查询     │ 统计报表   │ │
│  └─────────────┴──────────────┴──────────────┴────────────┘ │
└─────────────────────────┬───────────────────────────────────┘
                          │
┌─────────────────────────┴───────────────────────────────────┐
│                  数据存储层                                 │
│  ┌─────────────┬──────────────┬──────────────┬────────────┐ │
│  │ PostgreSQL  │ Redis缓存    │ MinIO存储    │ 文件系统   │ │
│  └─────────────┴──────────────┴──────────────┴────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 快速开始

### 1. 环境要求
- **操作系统**: Windows 10/11
- **Python**: 3.8+
- **Node.js**: 16+
- **内存**: 建议16GB+
- **显卡**: 支持CUDA的NVIDIA显卡（可选）

### 2. 一键安装
双击运行 `setup.bat` 脚本，自动完成：
- ✅ Python虚拟环境创建
- ✅ 依赖包安装
- ✅ 服务程序下载
- ✅ 配置文件生成
- ✅ 启动脚本创建

### 3. 启动服务
双击运行 `start.bat` 脚本，启动所有服务：
- 🌐 **前端界面**: http://localhost:3000
- 📡 **后端API**: http://localhost:8000/docs
- 🗄️ **PostgreSQL**: localhost:5432
- 💾 **Redis**: localhost:6379
- 📦 **MinIO**: http://localhost:9001

### 4. 检查状态
双击运行 `check-status.bat` 查看所有服务运行状态。

## 📁 项目结构

```
venv-project/
├── backend/                    # 后端API服务
│   ├── main.py                # FastAPI主程序
│   ├── requirements.txt       # Python依赖
│   └── ...
├── frontend/                   # 前端React应用
│   ├── src/                   # 源代码
│   ├── package.json           # Node.js依赖
│   └── ...
├── scripts/                   # 管理脚本
│   ├── services/              # 服务程序
│   └── utils/                 # 工具脚本
├── data/                      # 数据目录
│   ├── postgres/              # PostgreSQL数据
│   ├── redis/                 # Redis数据
│   └── minio/                 # MinIO对象存储
├── logs/                      # 日志文件
├── uploads/                   # 上传文件
├── temp/                      # 临时文件
├── models/                    # AI模型文件
├── venv/                      # Python虚拟环境
├── .env                       # 环境变量配置
├── requirements.txt           # Python依赖
├── setup.bat                  # 一键安装脚本
├── start.bat                  # 一键启动脚本
├── stop.bat                   # 一键停止脚本
└── check-status.bat           # 状态检查脚本
```

## 🔧 核心功能

### 数字员工创建
1. **文本输入**: 输入要生成的文本内容
2. **参考视频**: 上传参考人物视频
3. **语音合成**: CosyVoice生成中文语音
4. **唇形同步**: LatentSync生成唇形同步视频
5. **后处理**: 添加字幕、片头片尾等

### 任务管理
- ✅ 任务创建和参数配置
- ✅ 实时状态跟踪
- ✅ 批量任务处理
- ✅ 失败重试机制
- ✅ 优先级队列

### 质量评估
- 📊 LSE-C/LSE-D唇形一致性评分
- 🎯 主观MOS评分
- ⏱️ 处理时间统计
- 📈 成功率监控

### 素材管理
- 📁 参考视频上传和管理
- 🎵 音频文件处理
- 🖼️ 头像模板库
- 🎬 片头片尾模板

## 🎛️ 配置管理

### 环境变量 (.env)
```bash
# 数据库配置
DATABASE_URL=postgresql://postgres:password@localhost:5432/digital_employee

# Redis配置
REDIS_URL=redis://localhost:6379/0

# MinIO配置
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin

# AI模型配置
MODEL_DEVICE=cuda  # 或 cpu
TTS_MODEL=cosyvoice
LIPSYNC_MODEL=LatentSync

# 任务队列配置
QUEUE_MAX_RETRIES=3
QUEUE_TIMEOUT=3600
QUEUE_CONCURRENCY=2
```

### 质量指标
- **唇形一致性**: LSE-C ≥ 0.85, LSE-D ≤ 2.5
- **主观评分**: MOS ≥ 4.0
- **处理速度**: ≤ 60秒/条
- **成功率**: ≥ 98%

## 🔒 安全特性

### 数据安全
- 🔐 传输加密 (HTTPS)
- 💾 数据备份机制
- 🗑️ 安全删除策略
- 📝 审计日志

### 访问控制
- 👤 用户认证
- 🔑 权限管理
- 🚫 防暴力破解
- ⏰ 会话超时

## 📊 性能优化

### 资源管理
- 💾 内存优化（24GB显存管理）
- ⚡ 并发控制（最大20并发）
- 🔄 失败重试（最多3次）
- ⏱️ 超时控制（1小时）

### 缓存策略
- 🚀 Redis缓存热点数据
- 📁 本地缓存常用模型
- 💾 MinIO缓存生成结果
- 🔄 智能缓存清理

## 🛠️ 运维管理

### 监控告警
- 📊 服务健康检查
- 📈 性能指标监控
- 🚨 异常告警通知
- 📋 运行日志分析

### 备份恢复
- 💾 数据库自动备份
- 📁 文件系统备份
- 🔄 一键恢复机制
- 📊 备份完整性检查

## 📚 开发指南

### 后端开发
```bash
# 激活虚拟环境
venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 运行开发服务器
cd backend
python main.py
```

### 前端开发
```bash
# 安装依赖
cd frontend
npm install

# 运行开发服务器
npm run dev

# 构建生产版本
npm run build
```

## 🎯 使用场景

### 离线批量生成
- 📊 日产能：50条，峰值100条
- ⏰ 处理时间：≤60秒/条
- 🎯 适用：宣传视频、培训材料

### 准实时演示
- ⚡ 延迟：<1秒端到端
- 🎪 适用：现场展示、交互演示
- 📱 支持：移动设备播放

## 📞 技术支持

### 故障排查
1. 🔍 查看日志文件
2. 🧪 运行状态检查
3. 🔧 服务重启
4. 📞 联系技术支持

### 性能调优
1. 📊 性能监控
2. 🔧 参数优化
3. 💾 资源扩容
4. 🚀 算法升级

---

**💡 提示**: 本方案专为Windows环境优化，充分利用虚拟环境优势，简化部署流程，适合开发和小规模生产使用。