# 文件编码检测工具使用说明

## 工具概述

YDS-Lab文件编码检测工具是一套完整的解决方案，用于确保项目文件编码符合UTF-8无BOM规范，避免乱码问题。

## 工具组件

### 1. encoding_checker.py - 编码检测工具
检测文件编码格式，识别不符合规范的文件。

### 2. convert_encoding.py - 编码转换工具
将文件编码转换为UTF-8无BOM格式。

### 3. encoding_checker.conf - 配置文件
定义检测规则和参数。

### 4. GitHub Actions工作流
自动化编码检查流程。

## 快速开始

### 安装依赖
```bash
pip install chardet
```

### 基本使用

#### 1. 检测当前目录
```bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir .
```

#### 2. 检测特定文件
```bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --include "*.py"
```

#### 3. 严格模式（发现问题立即退出）
```bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --strict
```

#### 4. 生成检测报告
```bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --generate-report
```

### 编码转换

#### 1. 转换单个文件
```bash
python S:\\YDS-Lab\\01-struc\\tools\\convert_encoding.py myfile.py
```

#### 2. 批量转换
```bash
python S:\\YDS-Lab\\01-struc\\tools\\convert_encoding.py "*.py" "*.js" --backup
```

#### 3. 转换目录
```bash
python S:\\YDS-Lab\\01-struc\\tools\\convert_encoding.py src/ --backup --verify
```

### 监控模式

#### 1. 启动实时监控
```bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --watch --interval 300
```

#### 2. 自定义监控间隔
```bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --watch --interval 60
```

## 配置文件说明

编辑 `S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.conf` 文件：

```ini
[encoding_checker]
# 扫描目录
scan_dirs = S:\\YDS-Lab\\01-struc

# 包含的文件类型
include_patterns = *.py, *.js, *.ts, *.json, *.md

# 排除的目录
exclude_dirs = .git, __pycache__, node_modules

# 编码要求
required_encoding = utf-8
allow_bom = false

# 严格模式
fail_on_issue = true
```

## 常见问题

### Q: 工具报告我的Python文件编码异常，但文件看起来正常？
A: 文件可能在保存时使用了GBK或其他编码格式。使用转换工具转换即可：
```bash
python S:\\YDS-Lab\\01-struc\\tools\\convert_encoding.py your_file.py
```

### Q: 如何处理大量文件的编码问题？
A: 使用批量转换功能：
```bash
# 转换整个目录
python S:\\YDS-Lab\\01-struc\\tools\\convert_encoding.py src/ --backup --verify

# 转换特定类型文件
python S:\\YDS-Lab\\01-struc\\tools\\convert_encoding.py "src/**/*.py" --backup
```

### Q: Windows系统下批处理文件(.bat)如何处理？
A: Windows批处理文件可以使用GBK编码，需要在配置文件中设置：
```ini
# 在encoding_checker.conf中添加例外
exclude_files = *.bat, *.cmd
```

### Q: Git提交时如何自动检查编码？
A: 使用Git钩子：
```bash
# 创建pre-commit钩子
cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash
python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --strict
EOF

chmod +x .git/hooks/pre-commit
```

## 集成开发环境

### VS Code集成

#### 1. 安装任务
在 `.vscode/tasks.json` 中添加：
```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "检查编码",
            "type": "shell",
            "command": "python",
            "args": ["S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py", "--scan-dir", "."],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            }
        }
    ]
}
```

#### 2. 配置自动保存
在 `.vscode/settings.json` 中添加：
```json
{
    "files.encoding": "utf8",
    "files.autoGuessEncoding": false,
    "files.eol": "\n",
    "files.insertFinalNewline": true,
    "files.trimTrailingWhitespace": true
}
```

### PyCharm集成

#### 1. 设置文件编码
File → Settings → Editor → File Encodings:
- Global Encoding: UTF-8
- Project Encoding: UTF-8
- Default encoding for properties files: UTF-8

#### 2. 配置外部工具
File → Settings → Tools → External Tools:
```
Name: 编码检查
Program: python
Arguments: S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir $ProjectFileDir$
Working directory: $ProjectFileDir$
```

## CI/CD集成

### GitHub Actions
项目已包含自动化的GitHub Actions工作流：
- 每次推送和PR都会触发编码检查
- 发现问题会自动在PR中评论
- 支持手动触发批量修复

### Jenkins集成
```groovy
pipeline {
    agent any
    stages {
        stage('Encoding Check') {
            steps {
                sh 'python S:\\YDS-Lab\\01-struc\\tools\\encoding_checker.py --scan-dir . --strict'
            }
        }
    }
    post {
        always {
            publishHTML([
                allowMissing: false,
                alwaysLinkToLastBuild: true,
                keepAll: true,
                reportDir: '.',
                reportFiles: 'encoding_report.html',
                reportName: 'Encoding Report'
            ])
        }
    }
}
```

## 命令行参考

### encoding_checker.py参数
```
usage: encoding_checker.py [-h] [--scan-dir SCAN_DIR] [--config CONFIG]
                          [--output OUTPUT] [--output-format {html,json,csv,text}]
                          [--strict] [--fail-on-issue] [--watch] [--interval INTERVAL]
                          [--generate-report] [--full-scan]

YDS-Lab文件编码检测工具

optional arguments:
  -h, --help            show this help message and exit
  --scan-dir SCAN_DIR   要扫描的目录
  --config CONFIG       配置文件路径
  --output OUTPUT       输出报告文件
  --output-format {html,json,csv,text}
                        输出格式
  --strict              严格模式，发现问题立即退出
  --fail-on-issue       发现问题立即失败退出
  --watch               监控模式
  --interval INTERVAL   监控间隔（秒）
  --generate-report     生成检测报告
  --full-scan           全项目扫描
```

### convert_encoding.py参数
```
usage: convert_encoding.py [-h] [--output OUTPUT] [--encoding ENCODING]
                          [--backup] [--no-backup] [--verify] [--dry-run]
                          [--report REPORT] [--list-only]
                          files [files ...]

YDS-Lab编码转换工具

positional arguments:
  files                 要转换的文件或目录

optional arguments:
  -h, --help            show this help message and exit
  --output OUTPUT, -o OUTPUT
                        输出文件（默认覆盖原文件）
  --encoding ENCODING, -e ENCODING
                        目标编码（默认utf-8）
  --backup, -b          自动备份原文件
  --no-backup           不备份原文件
  --verify, -v          转换后验证结果
  --dry-run, -n         模拟运行，不实际转换
  --report REPORT, -r REPORT
                        生成转换报告文件
  --list-only, -l       只列出需要转换的文件
```

## 技术支持

如遇到问题，请：
1. 查看工具日志文件：`encoding_checker.log`
2. 检查配置文件语法是否正确
3. 确保Python版本≥3.6
4. 确认chardet库已正确安装
5. 联系开发部技术支持：dev-team@yds-lab.com

## 更新日志

### V1.0 (2024-11-13)
- ✨ 初始版本发布
- ✨ 支持UTF-8无BOM编码检测
- ✨ 提供批量转换功能
- ✨ 集成GitHub Actions工作流
- ✨ 支持实时监控模式