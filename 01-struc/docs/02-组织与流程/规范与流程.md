# 文档治理规范与流程（修订版）

## 0. 代码规范与自动化流程
- **参考文档**: [规范与流程-代码规范与自动化.md](规范与流程-代码规范与自动化.md)
- **主要内容**: 代码规范检查自动化流程、文档治理自动化流程、质量监控与报告、工具集成与扩展
- **适用范围**: 所有项目开发活动
- **执行频率**: 每日自动执行，手动触发支持

## 1. 目标与适用范围
- 统一公司、部门、项目与系统的文档入口与路径规范，确保可用、可治理、可审计。
- 适用范围：S:\YDS-Lab 全仓库（显式排除 backups/ 与 tmp/ 目录）。

## 修订声明（2025-11-09，优先生效）
- 公司级文档：统一放在 `S:\YDS-Lab\01-struc\docs` 下，按编号中文目录分类，如 `01-战略规划/、02-组织与流程/、03-技术文档/、04-对外文档/、05-模板库/、06-流程与交付/、07-资料库/`。
- 部门级文档：统一放在 `S:\YDS-Lab\01-struc\部门名\docs`（例如 `01-planning\docs/、02-finance\docs/` 等）。
- 项目文档：统一放在各项目根目录的 `项目名\docs`（例如 `03-dev\001-memory-system\docs/` 或 `04-prod\001-memory-system\docs/`）。
- 运维及临时文档：仅放在顶层 `S:\YDS-Lab\docs` 下（系统维护、治理报告、临时说明等）。
- 各类日志 logs：遵循上述分层位置（公司级 → `01-struc\logs`；部门级 → `01-struc\部门名\logs`；项目级 → `项目名\logs`；顶层运维机器日志 → 顶层 `logs`）。
- 各类报告 reports：与文档"同层级治理但分仓"——报告归档至对应层级`reports/`（公司级：`01-struc\reports`；部门级：`01-struc\部门名\reports`；项目级：`项目名\reports`；顶层运维：`S:\YDS-Lab\reports`）。报告文件命名采用`报告类型_YYYYMMDD_HHMMSS.扩展名`格式。
- 备份：所有备份统一打包放在顶层 `S:\YDS-Lab\backups\` 下，可按 daily/manual/legacy 分类；日常备份文件命名采用 `YYYYMMDD-HHmmss.zip`（例如 `backups\daily\20251109-214200.zip`）。

说明：以下旧版章节（原第2、3节）仅保留为历史记录，不再作为现行规则依据。

## 2. 文档分层与位置（现行规则）
- 公司级：`S:\YDS-Lab\01-struc\docs\`（编号中文目录：01-战略规划、02-组织与流程、03-技术文档、04-对外文档、05-模板库、06-流程与交付、07-资料库）。
- 部门级：`S:\YDS-Lab\01-struc\部门名\docs\`（各部门自主管理，推荐子结构：规章制度/、流程与SOP/、模板/、会议纪要/、项目资料/）。
- 项目级：`...\项目名\docs\`（位于 02-task、03-dev、04-prod 等项目根下）。
- 运维及临时：顶层 `S:\YDS-Lab\docs\`（系统维护、治理报告、临时说明、临时指引等）。
- 日志 logs：与文档"同层级治理但分仓"——文档归档至各层 `docs/`，机器日志归档至对应层级 `logs/`（公司级：`01-struc\logs`；部门级：`01-struc\部门名\logs`；项目级：项目根 `logs/`；顶层运维：顶层 `logs/`）。统一采用 `.log` 或日期前缀文件名；建议开启日志轮转（tools\LongMemory\log_rotate.ps1 可参考）。
- 报告 reports：与文档"同层级治理但分仓"——报告归档至对应层级 `reports/`（公司级：`01-struc\reports`；部门级：`01-struc\部门名\reports`；项目级：`项目名\reports`；顶层运维：`S:\YDS-Lab\reports`）。报告文件命名采用`报告类型_YYYYMMDD_HHMMSS.扩展名`格式，如`code_style_report_20251110_085754.json`。

## 3. 目录命名与编号
- 顶层目录与文档命名一律中文；公司级分类采用“编号-中文名”统一格式（如 `01-战略规划`）。
- README.md 统一命名；“读我.md”等变体统一治理为 README.md。
- 路径深度控制：建议不超过 8 层；文件名尽量不超过 100 字符。
- 日期与版本：推荐 `YYYYMMDD-HHmmss` 或 `vMAJOR.MINOR.PATCH`，避免多重前缀与过长文件名。

### 3.1 编号前缀规则（新增）
- 编号前缀支持两类形式：
  - 纯数字两位：例如 `01-市场部/`、`02_finance/`、`03 项目组/`（分隔符可为 `-`、`_` 或空格，推荐使用 `-`）。
  - 数字+字母：例如 `0A-board-chair/`（董事长办公室）、`0B-general-manager/`（总经办）。
- 应用范围：
  - `01-struc/` 下的各办公室与部门目录应采用上述编号前缀。
  - `01-struc/0B-general-manager/` 的一级子目录需使用编号前缀，以明确序层与职责范围。
- 例外清单（以下一级子目录名称作为保留位，部分可不使用编号前缀）：
  - `docs/`、`Docs/`、`logs/`、`config/`、`tools/`、`meetings/`、`archive/`、`archives/`、`backups/`。
  - 说明：`Log/`（大写）为历史保留名，现行规范统一使用小写 `logs/`，不再创建或保留新的 `Log/` 目录。
- 示例：
  - 顶层办公室/部门：`01-planning/`、`02-finance/`、`0A-board-chair/`、`0B-general-manager/`。
  - `0B-general-manager/` 下的编号子目录：`01-行政办公室/`、`02-财务协同组/`、`03-运营支撑/`。
  - 允许的例外子目录：`0B-general-manager/docs/`、`0B-general-manager/logs/`、`0B-general-manager/GeneralOffice/`（保留位用途见下文说明）。

## 4. 迁移与引用修复流程（即时执行版）
1) 创建目标目录：按上方集中路径与部门 docs 目录建立目标位置。
2) 首批物理迁移（公司类）：
   - 01-struc/SharedWorkspace/Documents → 01-struc/docs/07-资料库
   - 01-struc/SharedWorkspace/Templates → 01-struc/docs/05-模板库
   - 01-struc/Workflow/project_delivery → 01-struc/docs/06-流程与交付
3) 源目录留痕：在源目录写入 README 指引，说明新位置与生效时间。
4) 引用修复：全仓库文本路径替换（排除 backups/ 与 tmp/），文件类型覆盖 .md/.ps1/.psm1/.bat/.cmd/.py/.js/.ts/.json/.yaml/.yml/.ini/.txt。
5) 验证：
   - 搜索旧路径残留数量应降至 0；
   - 关键脚本运行与构建/部署验证通过；
   - 公司索引更新（01-struc/docs/README.md）。
6) 清理：源目录仅保留 README 指引，其他内容清空。

## 5. 风险控制
- 仅替换显式文本路径，不处理二进制文件。
- 保留操作日志与退路：一周内监测构建/部署脚本，如发现路径异常，滚动修复或回退。

## 6. 生效时间
- 自 2025-11-09 起生效（已完成公司类第一批迁移与引用修复）。

## 7. 部门文档自动索引任务（每日 00:10 执行）
- 任务名称：YDS-DeptDocsIndexDaily
- 执行脚本：tools/scripts/dept_index_daily.py（Python UTF-8 输出，避免 PowerShell 编码问题）
- 执行频率：每日 00:10
- 输出结果：各部门 docs 下生成/更新 INDEX.md，按“规章制度/流程与SOP/模板/会议纪要/项目资料”五类自动索引。
- 路径规范：索引内统一使用相对路径与正斜杠（/），兼容 Git 与 Markdown 渲染。
- 风险与回退：索引失败不影响原 README；可删除 INDEX.md，下一次任务会自动重建；必要时可临时禁用计划任务并手工执行脚本。
- 首次执行状态（2025-11-09）：已成功处理 7 个部门；市场部当前无存量文档，INDEX.md 已建立（空占位）。

## 8. 命名约定
- 文档与目录命名优先中文；顶层文档目录统一为小写 `docs/`。
- README.md 统一命名；“读我.md”等变体在治理中已统一为 README.md。

## 9. 路径长度与命名规范
- Windows 传统 API 存在 `MAX_PATH ≈ 260` 限制，已启用系统长路径支持，但仍需注意工具链兼容性。
- 命名瘦身：日期前缀统一为 `d_YYYYMMDD_HHMMSS`（例如 `d_20251109_153020`），避免多层冗长前缀。
- 覆盖报告处理：建议将 `coverage/lcov-report` 在备份落地时压缩为 `lcov_YYYYMMDD_HHMMSS.zip`，减少路径深度与体积。
- 脚本与复制：尽量使用 `robocopy` 或 PowerShell 操作代替 Explorer 拖拽；路径使用相对路径与正斜杠（/）以兼容 Markdown/Git。
- 排除规则：自动化替换与扫描显式排除 `backups/` 与 `tmp/`，避免误操作历史与临时目录。

## 10. 禁用仓库内 bak/backup/backups 目录（不分大小写）与替代路径
- 禁止在顶层 `S:\YDS-Lab\backups` 之外的任何位置新建或保留名为 `bak`、`backup`、`backups` 的目录（不分大小写）。
- 顶层保留与统一入口：仅保留 `S:\YDS-Lab\backups` 作为统一归档入口。
- 统一结构：
  - `backups/daily/`：系统每日自动备份（保留 14 天，详见 `config/backup_config.json`）。
  - `backups/manual/`：人工快照区（按需留存）。
  - `backups/legacy/`：超过阈值（默认 60 天）或历史清理归档区。
- 临时文件请使用 `tmp/`；项目自身如需运行期备份，请写入顶层 `backups/`，不得在项目内再建 `backups/` 或 `bak/`。
- 执行状态：历史 `bak/backup/backups`（除顶层 `backups/`）已清理。
- 变更留痕：涉及清理或迁移，须在治理报告中记录“来源、目标、时间、工具与日志”。

## 11. 顶层备份路径引用规范与环境变量
- 统一引用：代码与脚本中引用备份路径一律使用顶层 `S:\YDS-Lab\backups`，不得写入相对路径 `./backups`、`data/backups` 等。
- 环境变量：允许通过 `YDS_BACKUPS_ROOT` 覆盖顶层备份根路径（默认值：`S:\YDS-Lab\backups`）。
  - PowerShell 示例：
    - `$root = $env:YDS_BACKUPS_ROOT; if (-not $root) { $root = 'S:\\YDS-Lab\\backups' }`
  - Python 示例：
    - `import os; from pathlib import Path; ROOT = Path(os.environ.get('YDS_BACKUPS_ROOT', 'S:/YDS-Lab/backups'))`
  - Node/JS 示例：
    - `const backups = process.env.YDS_BACKUPS_ROOT || 'S\\\\YDS-Lab\\\\backups';`
- 项目内脚本改造建议：
  - 初始化脚本不再创建本地 `backups/`，改为写入 `YDS_BACKUPS_ROOT`；部署脚本在 `createDirectories` 阶段确保顶层备份目录存在。
  - 备份子结构约定：
    - `backups/daily/YYYYMMDD-HHmmss.zip`（自动任务，保留期默认14天）
    - `backups/manual/YYYYMMDD-HHmmss_说明.zip`（人工快照）
    - `backups/legacy/`（历史归档与长期保留）
- 覆盖报告与深路径控制：复制/备份到顶层后，对 `coverage/lcov-report` 进行 ZIP 压缩（命名 `lcov_YYYYMMDD_HHMMSS.zip`），避免深路径与大体积占用。

## 12. 日志路径引用规范与环境变量（新增）
- 分层落位：
  - 顶层运维机器日志：`S:\YDS-Lab\logs`
  - 公司级机器日志：`S:\YDS-Lab\01-struc\logs`
  - 部门级机器日志：`S:\YDS-Lab\01-struc\<部门名>\logs`
  - 项目级机器日志：`<项目根>\logs`
- LongMemory 专用落位（公司级视角）：`S:\YDS-Lab\01-struc\logs\longmemory`（默认文件：`lm_records.json`）
- 环境变量：
  - `YDS_LOGS_ROOT`：顶层运维机器日志根（默认：`S:\YDS-Lab\logs`）
  - `YDS_COMPANY_LOGS_ROOT`：公司级机器日志根（默认：`S:\YDS-Lab\01-struc\logs`）
  - `YDS_LONGMEMORY_ROOT`：LongMemory 公司级日志根（默认：`S:\YDS-Lab\01-struc\logs\longmemory`）
  - PowerShell 示例：
    - `$root = $env:YDS_COMPANY_LOGS_ROOT; if (-not $root) { $root = 'S:\\YDS-Lab\\01-struc\\logs' }`
  - Python 示例：
    - `import os; from pathlib import Path; LOGS = Path(os.environ.get('YDS_COMPANY_LOGS_ROOT', 'S:/YDS-Lab/01-struc/logs'))`
  - 迁移建议：脚本与服务端默认写入上述环境变量指定路径，未设置时按默认值落位；禁止将机器日志写入 `docs/`。

## 13. 生效与过渡（新增）
- 本修订即刻生效；旧路径 `01-struc/Log`（大写）删除，涉及引用统一替换为 `01-struc/logs`。
- 已存在的顶层 `docs/logs` 内容按需迁移至顶层 `logs/`；人读运维文档继续归档至 `docs/系统维护`。