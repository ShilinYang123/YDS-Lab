# 🚀 JS003-Trae长记忆功能 - 快速部署指南

> 仓库内置集成说明（YDS-Lab 使用）
>
> 本仓库已集成 Python 版 LongMemory 子系统，并通过 meetingroom_server 提供 HTTP 接口进行运行与管理：
>
> - 启动组件：POST /mcp/lm/start（component: monitor 或 reminder）
> - 停止组件：POST /mcp/lm/stop（component: monitor 或 reminder）
> - 查看状态：GET /mcp/lm/status?role=developer
> - 上报活动：POST /mcp/lm/report_activity
> - 上报错误：POST /mcp/lm/report_error
>
> 长记忆持久化路径已统一为：`logs/longmemory/lm_records.json`。
> 可通过环境变量 `YDS_LONGMEMORY_STORAGE_PATH` 或配置文件 `config/yds_ai_config.yaml` 的 `longmemory.storage_path` 覆盖；默认仍回落到上述统一路径。说明：旧路径 `tools/servers/yds_ai_config.yaml` 已废弃，且不再提供回退读取。
>
> 快速示例（PowerShell）：
>
> ```powershell
> # 启动
> Invoke-RestMethod -Method Post -Uri 'http://127.0.0.1:8020/mcp/lm/start' -ContentType 'application/json' -Body '{"role":"developer","component":"monitor"}'
> Invoke-RestMethod -Method Post -Uri 'http://127.0.0.1:8020/mcp/lm/start' -ContentType 'application/json' -Body '{"role":"developer","component":"reminder"}'
>
> # 查看状态
> Invoke-RestMethod -Method Get -Uri 'http://127.0.0.1:8020/mcp/lm/status?role=developer'
>
> # 上报活动
> $payload = @{ role = 'developer'; activity = 'commit_push'; details = @{ repo = 'YDS-Lab'; branch = 'main' } } | ConvertTo-Json -Depth 5
> Invoke-RestMethod -Method Post -Uri 'http://127.0.0.1:8020/mcp/lm/report_activity' -ContentType 'application/json' -Body $payload
>
> # 上报错误
> $err = @{ role = 'developer'; error = 'ExampleError'; message = '示例错误用于集成测试'; severity = 'low' } | ConvertTo-Json -Depth 5
> Invoke-RestMethod -Method Post -Uri 'http://127.0.0.1:8020/mcp/lm/report_error' -ContentType 'application/json' -Body $err
> ```
>
> 说明：首次启动后，`lm_records.json` 会产生频繁修改的智能提醒（smart_error_alert），属于正常行为；若在控制台看到中文提示出现乱码，可在 PowerShell 中执行 `[Console]::OutputEncoding = [System.Text.Encoding]::UTF8` 以改善显示。

## 📋 部署前准备

### 环境检查清单

在开始部署之前，请确保您的环境满足以下要求：

- ✅ **Node.js**: 版本 >= 16.0.0
- ✅ **npm**: 版本 >= 7.0.0 (或 yarn >= 1.22.0)
- ✅ **TypeScript**: 版本 >= 4.5.0
- ✅ **Git**: 版本 >= 2.20.0 (仅Git子模块方式需要)
- ✅ **操作系统**: Windows 10+, macOS 10.15+, 或 Linux
- ✅ **内存**: 至少 512MB 可用内存
- ✅ **存储**: 至少 100MB 可用存储空间

### 快速环境检查

```bash
# 检查Node.js版本
node --version

# 检查npm版本
npm --version

# 检查TypeScript版本
tsc --version

# 检查Git版本 (可选)
git --version
```

## 🎯 方案选择指南

### 30秒快速选择

回答以下问题来选择最适合的部署方案：

1. **您的主要目标是什么？**
   - 🚀 快速集成到生产环境 → **NPM包方式**
   - 🛠️ 深度定制和修改功能 → **源码复制方式**
   - 👥 多项目共享和团队协作 → **Git子模块方式**

2. **您的技术背景如何？**
   - 🟢 熟悉npm包管理 → **NPM包方式**
   - 🟡 熟悉源码开发 → **源码复制方式**
   - 🔴 熟悉Git子模块 → **Git子模块方式**

3. **您的项目规模如何？**
   - 🏢 企业级/生产环境 → **NPM包方式**
   - 🏠 个人项目/学习研究 → **源码复制方式**
   - 👥 团队项目/多仓库 → **Git子模块方式**

## 🚀 方案1: NPM包方式 (推荐)

### ⏱️ 预计时间: 5-10分钟

### 第一步: 安装包

```bash
# 进入您的项目目录
cd your-project

# 安装长记忆功能包
npm install js003-trae-memory-system

# 或使用yarn
yarn add js003-trae-memory-system
```

### 第二步: 基本配置

创建配置文件 `memory-config.yaml`:

```yaml
# memory-config.yaml
memory:
  storage:
    type: "file"
    path: "./data/memory"
  performance:
    maxMemoryItems: 10000
    cacheSize: 1000
  features:
    enableSemanticSearch: true
    enablePerformanceMonitoring: true
```

### 第三步: 快速集成

```typescript
// src/memory-setup.ts
import { LongTermMemorySystem } from 'js003-trae-memory-system';

// 初始化记忆系统
const memorySystem = new LongTermMemorySystem({
  configPath: './memory-config.yaml'
});

// 启动系统
await memorySystem.initialize();

// 存储记忆
await memorySystem.storeMemory({
  content: "这是一个重要的开发经验",
  type: "experience",
  tags: ["开发", "最佳实践"]
});

// 检索记忆
const memories = await memorySystem.searchMemories("开发经验");
console.log(memories);
```

### 第四步: 验证部署

```bash
# 运行测试
npm test

# 启动应用
npm start
```

### ✅ 完成！

您的长记忆功能已经成功部署！

---

## 🛠️ 方案2: 源码复制方式

### ⏱️ 预计时间: 15-20分钟

### 第一步: 下载复制脚本

从 `迁移方案2-源码复制方式` 目录获取 `copy-memory-system.bat` 脚本。

### 第二步: 运行复制脚本

```bash
# Windows
copy-memory-system.bat "C:\path\to\your\project"

# Linux/macOS (需要先转换脚本)
./copy-memory-system.sh "/path/to/your/project"
```

### 第三步: 安装依赖

```bash
cd your-project

# 安装核心依赖
npm install yaml uuid lodash

# 安装开发依赖
npm install --save-dev @types/node @types/uuid @types/lodash typescript jest
```

### 第四步: 配置TypeScript

确保您的 `tsconfig.json` 包含以下配置：

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

### 第五步: 集成到项目

```typescript
// src/app.ts
import { LongTermMemorySystem } from './memory-system';

const memorySystem = new LongTermMemorySystem();
await memorySystem.initialize();

// 您的应用逻辑...
```

### 第六步: 验证部署

```bash
# 编译TypeScript
npx tsc

# 运行测试
npm test

# 启动应用
npm start
```

### ✅ 完成！

源码已成功复制并集成到您的项目中！

---

## 👥 方案3: Git子模块方式

### ⏱️ 预计时间: 10-15分钟

### 第一步: 准备Git仓库

确保您的项目是一个Git仓库：

```bash
cd your-project

# 如果不是Git仓库，初始化一个
git init

# 添加远程仓库 (如果需要)
git remote add origin https://github.com/your-username/your-project.git
```

### 第二步: 运行设置脚本

从 `迁移方案3-Git子模块方式` 目录获取 `setup-submodule.bat` 脚本：

```bash
# Windows
setup-submodule.bat "C:\path\to\your\project" "src/memory-system" "https://github.com/trae-ai/long-term-memory.git"

# Linux/macOS
./setup-submodule.sh "/path/to/your/project" "src/memory-system" "https://github.com/trae-ai/long-term-memory.git"
```

### 第三步: 初始化子模块

```bash
cd your-project

# 初始化子模块
git submodule init

# 更新子模块
git submodule update

# 或者一步完成
git submodule update --init --recursive
```

### 第四步: 配置项目

```typescript
// src/memory-integration.ts
import { LongTermMemorySystem } from './memory-system/src';

const memorySystem = new LongTermMemorySystem({
  configPath: './.trae/rules/memory-config.yaml'
});

await memorySystem.initialize();
```

### 第五步: 提交更改

```bash
# 添加子模块到版本控制
git add .gitmodules src/memory-system

# 提交更改
git commit -m "Add long-term memory system as submodule"

# 推送到远程仓库
git push origin main
```

### 第六步: 团队协作设置

团队成员克隆项目时需要：

```bash
# 克隆项目包含子模块
git clone --recursive https://github.com/your-username/your-project.git

# 或者先克隆再初始化子模块
git clone https://github.com/your-username/your-project.git
cd your-project
git submodule update --init --recursive
```

### ✅ 完成！

Git子模块已成功设置，团队可以协作开发！

---

## 🔧 部署后配置

### 基本配置文件

无论选择哪种方案，都建议创建以下配置文件：

#### 1. 个人规则配置 (`.trae/rules/personal-rules.yaml`)

```yaml
personal:
  preferences:
    language: "zh-CN"
    codeStyle: "typescript"
    indentation: 2
  
  workHabits:
    preferredFrameworks: ["React", "Express", "Jest"]
    codingPatterns: ["async/await", "functional"]
  
  memory:
    autoSave: true
    categories: ["bug-fixes", "optimizations", "learnings"]
```

#### 2. 项目规则配置 (`.trae/rules/project-rules.yaml`)

```yaml
project:
  name: "Your Project Name"
  type: "web-application"
  
  development:
    codeStandards:
      linting: "eslint"
      formatting: "prettier"
      testing: "jest"
    
    fileOrganization:
      srcDir: "src"
      testDir: "tests"
      configDir: "config"
  
  memory:
    enableTeamSharing: true
    syncInterval: "1h"
```

### 环境变量配置

创建 `.env` 文件：

```bash
# 记忆系统配置
MEMORY_STORAGE_PATH=./data/memory
MEMORY_MAX_ITEMS=10000
MEMORY_CACHE_SIZE=1000

# 性能监控
ENABLE_PERFORMANCE_MONITORING=true
PERFORMANCE_LOG_LEVEL=info

# 团队协作
ENABLE_TEAM_SHARING=false
TEAM_SYNC_ENDPOINT=https://your-team-server.com/api/memory
```

## 🧪 部署验证

### 功能测试脚本

创建 `test-deployment.js` 来验证部署：

```javascript
// test-deployment.js
const { LongTermMemorySystem } = require('./src/memory-system'); // 根据您的方案调整路径

async function testDeployment() {
  console.log('🧪 开始部署验证...');
  
  try {
    // 1. 初始化系统
    console.log('1️⃣ 初始化记忆系统...');
    const memorySystem = new LongTermMemorySystem();
    await memorySystem.initialize();
    console.log('✅ 系统初始化成功');
    
    // 2. 存储测试记忆
    console.log('2️⃣ 测试记忆存储...');
    await memorySystem.storeMemory({
      content: "部署测试记忆",
      type: "test",
      tags: ["deployment", "verification"]
    });
    console.log('✅ 记忆存储成功');
    
    // 3. 检索测试记忆
    console.log('3️⃣ 测试记忆检索...');
    const memories = await memorySystem.searchMemories("部署测试");
    if (memories.length > 0) {
      console.log('✅ 记忆检索成功');
      console.log(`📊 找到 ${memories.length} 条相关记忆`);
    } else {
      console.log('❌ 记忆检索失败');
    }
    
    // 4. 性能测试
    console.log('4️⃣ 测试系统性能...');
    const startTime = Date.now();
    for (let i = 0; i < 10; i++) {
      await memorySystem.storeMemory({
        content: `性能测试记忆 ${i}`,
        type: "performance-test"
      });
    }
    const endTime = Date.now();
    const avgTime = (endTime - startTime) / 10;
    console.log(`✅ 性能测试完成，平均存储时间: ${avgTime}ms`);
    
    console.log('🎉 部署验证完成！所有功能正常工作。');
    
  } catch (error) {
    console.error('❌ 部署验证失败:', error.message);
    process.exit(1);
  }
}

testDeployment();
```

运行验证：

```bash
node test-deployment.js
```

## 🚨 常见问题排查

### 问题1: 模块找不到

**错误**: `Cannot find module 'js003-trae-memory-system'`

**解决方案**:
```bash
# 检查包是否正确安装
npm list js003-trae-memory-system

# 重新安装
npm install js003-trae-memory-system

# 清除缓存重新安装
npm cache clean --force
npm install
```

### 问题2: TypeScript编译错误

**错误**: `Cannot find type definitions`

**解决方案**:
```bash
# 安装类型定义
npm install --save-dev @types/node @types/uuid @types/lodash

# 检查tsconfig.json配置
# 确保包含 "esModuleInterop": true
```

### 问题3: 配置文件找不到

**错误**: `Configuration file not found`

**解决方案**:
```bash
# 创建默认配置目录
mkdir -p .trae/rules

# 复制示例配置文件
cp 迁移方案*/示例配置/* .trae/rules/
```

### 问题4: 权限错误

**错误**: `Permission denied`

**解决方案**:
```bash
# Windows
# 以管理员身份运行命令提示符

# Linux/macOS
sudo chown -R $USER:$USER ./
chmod -R 755 ./
```

## 📞 获取帮助

如果遇到问题，可以通过以下方式获取帮助：

1. **查看详细文档**: 阅读 `JS003-Trae长记忆功能使用说明书.md`
2. **检查示例代码**: 参考各方案目录下的 `使用示例.ts`
3. **运行诊断脚本**: 使用上面的 `test-deployment.js` 脚本
4. **查看日志文件**: 检查 `./logs/memory-system.log`
5. **联系技术支持**: 通过GitHub Issues报告问题

## 🎯 下一步

部署完成后，建议您：

1. **阅读完整文档**: 深入了解所有功能特性
2. **配置个性化规则**: 根据团队需求调整配置
3. **集成到工作流**: 将记忆系统集成到日常开发流程
4. **监控性能**: 定期检查系统性能和使用情况
5. **团队培训**: 为团队成员提供使用培训

---

**🎉 恭喜！您已成功部署JS003-Trae长记忆功能！**

> 💡 **提示**: 建议从NPM包方式开始，这是最稳定和易用的部署方案。如有特殊需求，可以随时切换到其他方案。